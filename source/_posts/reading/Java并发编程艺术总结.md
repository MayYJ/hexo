---
title: Java并发编程艺术总结
date: 2019-01-02 16:42:09
tags: Java并发编程艺术
category: reading
---

#### 并发编程的挑战

#####  上下文切换

**定义**

上下文切换就是CPU调度切换线程的时候，将上一个线程的数据保存下来，然后将下一个线程的数据引入CPU以便接下来的运行，如果线程的数量较多这是一个不小得开销

**切换原因**

1. 时间片使用完
2. 中断处理
3. 用户状态切换
4. IO阻塞
5. 用户代码挂起当前任务

**减少切换次数方法**

1. 无锁并发：在有锁的情况下，大量的线程会由runnable->waiting，waiting->runnable 两种状态切换，也就会导致大量的线程的切换
2. CAS算法：操作系统级别提供的原子操作，减少锁从而减少上面的情况出现
3. 减少线程数：线程数量越多，如果任务少越多的线程处于waiting状态，那么增加由waiting->runnable状态的切换也就增加了上下文切换的次数
4. 使用协程

**线程数量的平衡**

1. 高并发，低耗时：建议少线程，满足并发即可；这种情况下我们就应该考虑怎样减少上下文切换，因为大量的连接但是每个连接又只做很少的事情如果单独创建一个线程，就会在上下文切换中花费大量的时间；这也是IO多路复用使用的原因，很多连接只需要在一个线程里面处理即可
2. 低并发，高耗时：建议多线程，保证有空闲的线程接受新的任务；如果这种情况下使用IO多路复用，会出现任务反应很慢的情况，因为多路复用必须要等到上一个任务完成才能执行下一个任务

